---
title: "The Trait-Based Model"
output:
  html_document:
    toc: yes
    fig_width: 5
    fig_height: 5
---

## Load codes adn libraries

```{r include=FALSE}

rm(list=ls())
library(tidyverse)
library(ggplot2)
library(Jmisc) # sourceAll function
library(assertthat) # needed for: newTraitParams()

path<-"/Users/nov017/R-projects/Mizer-trait/R"
sourceAll(path)

```


## Introduction

In a trait-based model the asymptotic size is considered to be the most
important *trait* characterizing a species. Most of the species-specific
parameters, such as $\beta$ and $\sigma$, are the same for all species. Other
model parameters are determined by the asymptotic size. For example, the weight
at maturation is a fixed fraction of the asymptotic size. The asymptotic sizes
of the species are spread evenly on a logarithmic scale The number of species
is not important and does not affect the general dynamics of the model 

## Setting up a trait-based model {#sec:set_up_trait_model}

See the help page for `newCommunityParams()` for more details.

Egg production is dependent on mature individuals investing part
of their energy income into reproduction. The relationship between the energy
invested into reproduction and the actual rate of egg production is modelled 
using a *Beverton-Holt* type function (the
default in `mizer`, see [the section on density-dependence in reproduction](model_description.html#recruitment)) where the reproduction rate $R_i$ (numbers per time) approaches a maximum as the energy invested increases.

Here we set up the model to have 3 species, with asymptotic sizes ranging from 
1 g to 10 kg. All the other parameters have default values. 

```{r label=demo_trait_model_params}
params <- newTraitParams(no_sp = 3, min_w_inf = 1, max_w_inf = 10)
summary(params)

# change interaction 
# only sp 3 (carniv feeds on 1 and 2)
# species 1 and 2 feeds only on background 1 and 2 and sp 3 does not feed on background
params@interaction
params@species_params # interaction_p??!

# extension example : https://rpubs.com/gustav/plankton-anchovy

```

The summary shows us that now we have 10 species in the model, with asymptotic
sizes ranging from $`r min(species_params(params)$w_inf)`$ to $`r
max(species_params(params)$w_inf)`$. The rather strange-looking values for the
sizes is due to the fact that the size classes are equally spaced on a
logarithmic scale.

The size at maturity (`w_mat`) is linearly related to the asymptotic size. Each
species has the same preferred predator-prey mass ratio parameter values (`beta`
and `sigma`, see 
[the section on predator/prey mass ratio](model_description.html#sec:ppmr)). 
There are $`r length(w(params))`$ size
bins in the community and $`r length(w_full(params))`$ size bins including the
resource spectrum. 

## Running the trait-based model {#sec:running_trait_model}

Here we project the model for 75 years without any fishing.
We use the default initial population abundances so there is no need to pass in
any initial population values (see 
[the section on setting the initial abundances](running_a_simulation.html#sec:setting_initial_abundances)).

```{r label=trait_project_no_fishing}
sim <- project(params, t_max = 75, effort = 0)
plot(sim)

```

As this is a trait-based model where all
species fully interact with each other, the predation mortality and feeding
level by size is the same for each species. In this simulation we turned fishing
off so the fishing mortality is 0. The size-spectra show the abundances at size
to be evenly spaced by log of asymptotic size.

